$(document).ready(function(){
  var currentTurnPosition;
  var playerOneName = "Red";
  var playerTwoName = "Black";
  var whosFirst;
  var currentPlayer;

  var changePlayer = function(current){
    if (current == "red"){
      currentPlayer = "black";
    } else {
      currentPlayer = "red";
    }
  };

  var checkWinner = function(currentPlayer, targetPosition){
    for(var i = 0; i <= 48;  i++){
      if((i + 3 <= 48 &&
          i != 4 && i!= 5 && i != 6 &&
          i != 11 && i!= 12 && i != 13 &&
          i != 18 && i!= 19 && i != 20 &&
          i != 25 && i!= 26 && i != 27 &&
          i != 32 && i!= 33 && i != 34 &&
          i != 39 && i!= 40 && i != 41 &&
          i != 46 && i!= 47 && i != 48 &&
          $(".piece-holder").eq(i).children().first().hasClass(currentPlayer) &&
          $(".piece-holder").eq(i + 1).children().first().hasClass(currentPlayer) &&
          $(".piece-holder").eq(i + 2).children().first().hasClass(currentPlayer) &&
          $(".piece-holder").eq(i + 3).children().first().hasClass(currentPlayer))
          || (i + (7*3) <= 48 &&
          $(".piece-holder").eq(i).children().first().hasClass(currentPlayer) &&
          $(".piece-holder").eq(i + 7).children().first().hasClass(currentPlayer) &&
          $(".piece-holder").eq(i + (7*2)).children().first().hasClass(currentPlayer) &&
          $(".piece-holder").eq(i + (7*3)).children().first().hasClass(currentPlayer))
          || (i + (7*3+3) <= 48 &&
          $(".piece-holder").eq(i).children().first().hasClass(currentPlayer) &&
          $(".piece-holder").eq(i + 7 + 1).children().first().hasClass(currentPlayer) &&
          $(".piece-holder").eq(i + (7*2+2)).children().first().hasClass(currentPlayer) &&
          $(".piece-holder").eq(i + (7*3+3)).children().first().hasClass(currentPlayer))
          || (i + (7*3) <= 48 &&
          i != 0 && i!= 1 && i != 2 &&
          i != 7 && i!= 8 && i != 9 &&
          i != 14 && i!= 15 && i != 16 &&
          i != 21 && i!= 22 && i != 23 &&
          i != 28 && i!= 29 && i != 30 &&
          i != 35 && i!= 36 && i != 37 &&
          i != 42 && i!= 43 && i != 44 &&
          $(".piece-holder").eq(i).children().first().hasClass(currentPlayer) &&
          $(".piece-holder").eq(i + 7 - 1).children().first().hasClass(currentPlayer) &&
          $(".piece-holder").eq(i + (7*2-2)).children().first().hasClass(currentPlayer) &&
          $(".piece-holder").eq(i + (7*3-3)).children().first().hasClass(currentPlayer))
        ){
        alert("yehey!");
      };
    };
  };

  var startGame = function(){
    $(".connect-player-buttons").hide();
    $(".connect-board").show();
  };

  var prepareNewGame = function(players){
    if(players == "one"){
      playerOneName = prompt("Please Enter Red Player");
      playerTwoName = "Computer";
    } else {
      playerOneName = prompt("Please Enter Red Player");
      playerTwoName = prompt("Please Enter Black Player");
    }
    whosFirst = prompt("Who will play first?");

    if (whosFirst.toLowerCase() == playerOneName.toLowerCase()
        || whosFirst.toLowerCase() == "red"){
      currentPlayer = "red";
    } else if (whosFirst.toLowerCase() == playerTwoName.toLowerCase()
        || whosFirst.toLowerCase() == "black") {
      currentPlayer = "black";
    } else {
      currentPlayer = "red";
    };
    startGame();
  };

  $(".turn-position").hover(
    function(){
      currentTurnPosition = $(this).html();
      $(this).addClass((currentPlayer == "red") ? "red" : "black");
    },
    function(){
      $(this).removeClass("red black");
    }
  );

  $(".turn-position").click(function(){
    var initialPosition = $(this).data("position");
    var filledPosition = 0;
    var targetPosition = 0;
    var lastPossiblePosition = initialPosition + (7*6);
    var hasRed;
    var hasBlack;

    for(var i = lastPossiblePosition; i >= 1; i-=7){
      hasRed = $(".piece-holder").eq(i - 1).children().first().hasClass("red");
      hasBlack = $(".piece-holder").eq(i - 1).children().first().hasClass("black");
      if (hasRed || hasBlack){
        filledPosition++;
      };
    };
    targetPosition = initialPosition + (7 * (6 - filledPosition));
    $(this).removeClass((currentPlayer == "red") ? "red" : "black");
    $(this).addClass((currentPlayer == "red") ? "black" : "red");
    $(".piece-holder").eq(targetPosition - 1).children().first().addClass((currentPlayer == "red") ? "red" : "black");
    checkWinner(currentPlayer, targetPosition - 1);
    changePlayer(currentPlayer);
  })

  $(".start-1p-btn").click(function(e){
    e.preventDefault();
    prepareNewGame("one");
  });

  $(".start-2p-btn").click(function(e){
    e.preventDefault();
    prepareNewGame("two");
  });
});